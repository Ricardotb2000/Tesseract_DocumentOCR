<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OCR con Tesseract</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" />
    <style>
        body {
            font-family: 'Arial', sans-serif;
            background-color: #f4f4f4;
            margin: 0;
            padding: 0;
        }
        
        .container {
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            text-align: center;
        }

        h1 {
            color: #333;
            margin-bottom: 20px;
        }

        input[type="file"] {
            display: none; /* Ocultar el input de archivo */
        }

        label {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
        }

        label:hover {
            background-color: #0056b3;
        }

        .image-preview {
            max-width: 100%;
            height: auto;
            margin-top: 20px;
            border: 2px dashed #ccc;
            border-radius: 5px;
            display: none; /* Ocultar inicialmente */
        }

        .cropper-container {
            margin-top: 20px;
        }

        input[type="button"] {
            background-color: #28a745;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s;
            margin-top: 20px;
        }

        input[type="button"]:hover {
            background-color: #218838;
        }

        /* Estilos del control deslizante */
        .slider-container {
            margin-top: 20px;
        }

        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 5px;
            border-radius: 5px;
            background: #ccc;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 15px;
            height: 15px;
            background: #28a745;
            border-radius: 50%;
            cursor: pointer;
        }

        .slider::-moz-range-thumb {
            width: 15px;
            height: 15px;
            background: #28a745;
            border-radius: 50%;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>OCR con Tesseract</h1>
        <form id="formulario" action="/procesar" method="post" enctype="multipart/form-data">
            <label for="file-upload">Selecciona una imagen</label>
            <input type="file" id="file-upload" name="file" accept="image/*" required onchange="mostrarImagen(event)">
            <br>
            <img id="imagen-preview" class="image-preview" alt="Imagen Previa">
            <br>
            <input type="button" value="Recortar y procesar OCR" onclick="enviarImagenRecortada()">
            
            <div class="slider-container" id="slider-container" style="display: none;">
                <input type="range" id="rotation-slider" class="slider" min="-360" max="360" value="0" step="1" onchange="rotarImagen()">
            </div>
        </form>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
    <script>
        let cropper;

        function mostrarImagen(event) {
            const imagen = document.getElementById('imagen-preview');
            imagen.src = URL.createObjectURL(event.target.files[0]);
            imagen.style.display = 'block';

            // Mostrar el control deslizante
            document.getElementById('slider-container').style.display = 'block';

            // Inicializar Cropper.js
            if (cropper) {
                cropper.destroy();
            }
            cropper = new Cropper(imagen, {
                aspectRatio: NaN, // Cambia esto si deseas una relación de aspecto específica
                viewMode: 1,
                autoCropArea: 1,
                modal: true,
                guides: true,
                highlight: true,
            });
        }

        function rotarImagen() {
            const slider = document.getElementById('rotation-slider');
            const rotationValue = slider.value;

            if (cropper) {
                cropper.rotateTo(rotationValue); // Rotar la imagen según el valor del slider
            }
        }

        function enviarImagenRecortada() {
            if (cropper) {
                const canvas = cropper.getCroppedCanvas();
                canvas.toBlob((blob) => {
                    const formData = new FormData();
                    formData.append('file', blob, 'recorte.jpg'); // Renombrar el archivo si lo deseas

                    fetch('/procesar', {
                        method: 'POST',
                        body: formData,
                    })
                    .then(response => response.text())
                    .then(data => {
                        document.body.innerHTML = data; // Mostrar el resultado
                    });
                });
            }
        }
    </script>
</body>
</html>
